"use client";

import { useEffect, useState } from 'react';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, useStripe, useElements, PaymentElement } from '@stripe/react-stripe-js';\n\nconst stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!);\n\ninterface CheckoutFormProps {\n  clientSecret: string;\n  walletAddress: string;\n  amount: number;\n  invoice?: string;\n  redirectUrl?: string | null;\n}\n\nconst Form = ({ clientSecret, walletAddress, amount, invoice, redirectUrl }: CheckoutFormProps) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!stripe || !elements) return;\n\n    setLoading(true);\n    setIsProcessing(true);\n    \n    const { error: submitError } = await elements.submit();\n    if (submitError) {\n      setError(submitError.message || 'Error al procesar los datos de pago');\n      setLoading(false);\n      setIsProcessing(false);\n      return;\n    }\n\n    setError(null);\n    \n    const { error } = await stripe.confirmPayment({\n      clientSecret,\n      elements,\n      confirmParams: {\n        return_url: redirectUrl\n          ? `${redirectUrl}?success=true&tokens=${amount}&invoice=${encodeURIComponent(invoice || '')}`\n          : `${window.location.origin}/success?success=true&tokens=${amount}&invoice=${encodeURIComponent(invoice || '')}`,\n      },\n    });\n\n    if (error) {\n      setError(error.message || 'Error en el pago');\n      setIsProcessing(false);\n    }\n    \n    setLoading(false);\n  };\n\n  // Estados del botón\n  const getButtonState = () => {\n    if (!stripe) return 'Cargando...';\n    if (isProcessing) return 'Verificando pago...';\n    if (loading) return 'Procesando...';\n    return `Pagar €${amount.toFixed(2)}`;\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      {/* Información del pago */}\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between p-4 bg-gradient-to-r from-slate-900/50 to-slate-800/50 rounded-xl border border-slate-700/50 backdrop-blur-sm\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center\">\n              <svg className=\"w-5 h-5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\" />\n              </svg>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-slate-300\">Total a pagar</p>\n              <p className=\"text-2xl font-bold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent\">\n                €${amount.toFixed(2)}\n              </p>\n            </div>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-sm font-medium text-slate-300\">Recibirás</p>\n            <p className=\"text-2xl font-bold bg-gradient-to-r from-emerald-400 to-emerald-300 bg-clip-text text-transparent\">\n              ${amount} EURT\n            </p>\n          </div>\n        </div>\n        \n        <div className=\"p-3 bg-slate-900/50 rounded-lg border border-slate-700/50 text-xs text-slate-400\">\n          <div className=\"flex justify-between\">\n            <span>Dirección de destino:</span>\n            <span className=\"font-mono\">{walletAddress.slice(0, 6)}...{walletAddress.slice(-4)}</span>\n          </div>\n          {invoice && (\n            <div className=\"flex justify-between mt-1\">\n              <span>Referencia:</span>\n              <span className=\"font-mono\">{invoice}</span>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Elemento de pago */}\n      <div className=\"p-4 bg-slate-900/40 rounded-xl border border-slate-700/50 backdrop-blur-sm\">\n        <div className=\"flex items-center space-x-2 mb-3\">\n          <svg className=\"w-5 h-5 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\" />\n          </svg>\n          <h4 className=\"text-sm font-semibold text-slate-300\">Información de la tarjeta</h4>\n        </div>\n        \n        <div className=\"p-3 bg-slate-800/50 rounded-lg border border-slate-600/30\">\n          <PaymentElement \n            options={{\n              fields: {\n                billingDetails: {\n                  address: 'never'\n                }\n              }\n            }}\n          />\n        </div>\n        \n        {error && (\n          <div className=\"mt-3 p-3 bg-red-900/30 rounded-lg border border-red-500/30 flex items-center space-x-2\">\n            <svg className=\"w-4 h-4 text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n            <p className=\"text-sm text-red-300\">{error}</p>\n          </div>\n        )}\n      </div>\n\n      {/*